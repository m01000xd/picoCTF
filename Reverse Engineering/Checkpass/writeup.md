![image](https://github.com/m01000xd/picoCTF/assets/122852491/53cb796b-3078-435f-8700-436bd11dece4)

![image](https://github.com/m01000xd/picoCTF/assets/122852491/57e18ca1-f28d-4bb8-9519-69d8d1b1ca08)

![image](https://github.com/m01000xd/picoCTF/assets/122852491/ab04617c-d240-4397-b201-7e2faa1e0e78)

Nhìn qua hàm main thì thấy khá khó hiểu, thử Shift + F12 tìm thử vài string có liên quan

![image](https://github.com/m01000xd/picoCTF/assets/122852491/f8877cab-dc43-47cc-877b-5e41758c7eb4)

Tìm "picoCTF" thì thấy xuất hiện, data xref trong 1 hàm ```sub_563F0BE05960```. Vào hàm này xem thử

![image](https://github.com/m01000xd/picoCTF/assets/122852491/b4f331f0-dfe0-4cc1-9e1d-17b2f08c4164)

Ở đây có vẻ như chính là hàm check password.

![image](https://github.com/m01000xd/picoCTF/assets/122852491/b2da15b2-e720-47f8-8b9d-6f54c3eca42f)

Ở đoạn này, mình thấy dòng if so sánh con trỏ ```v0``` với địa chỉ của biến ```unk_563F0BE39D78```, hoặc nó sẽ so sánh giá trị của con trỏ ```v0```
với chuỗi ```picoCTF{```

![image](https://github.com/m01000xd/picoCTF/assets/122852491/029c2cc5-14ab-4b11-b912-7a1a7957eb51)

Và ở đây, check xem giá trị của v0[0x28] có bằng chuỗi ```}``` không. Từ đây mình rút ra flag sẽ dài 0x29, tức 41 kí tự.

![image](https://github.com/m01000xd/picoCTF/assets/122852491/b58a2598-20f5-4bf7-b112-6064e0789f07)

Đúng là như vậy, mình thử nhập 41 và 40 kí tự ```a```, thì nếu không phải 41 kí tự thì chương trình trả về ```Invalid length```.

![image](https://github.com/m01000xd/picoCTF/assets/122852491/d3d627f1-a307-42d7-9b5b-124d7680264d)

Từ đoạn này, hàm sẽ kiểm tra kí tự ```flag[8]``` và ```flag[0x28]``` có lớn hơn -1 không, nếu có thì sẽ cấp phát bộ nhớ cho mảng v3 chứa 0x20 tức
32 kí tự.

![image](https://github.com/m01000xd/picoCTF/assets/122852491/734d86d1-1fd1-4887-9dda-523df04b7d81)

Với đoạn này, hàm ```sub_563F0BE06720``` dùng để check xem có tràn bộ nhớ không qua hàm ```__CFADD__```

![image](https://github.com/m01000xd/picoCTF/assets/122852491/f176a840-9f07-4d69-b3bc-2b7a0fbbcfe1)

![image](https://github.com/m01000xd/picoCTF/assets/122852491/dbf1b4ad-ac55-424f-8fc6-021cc803525d)

![image](https://github.com/m01000xd/picoCTF/assets/122852491/34577a36-1560-49a8-a6ff-60e41d775ff6)

Ở đoạn này, ta thấy có 1 hàm ```sub_563F0BE054E0``` được gọi tận 4 lần. Vào xem thử bên trong có gì.

![image](https://github.com/m01000xd/picoCTF/assets/122852491/82eef669-7d46-4a9c-afce-d933d22d757a)
![image](https://github.com/m01000xd/picoCTF/assets/122852491/e61ec197-b94e-4004-b82a-aaecee07ae39)
![image](https://github.com/m01000xd/picoCTF/assets/122852491/067c066a-65f2-4abb-ad4c-f3459a6d9a88)

Đọc sơ qua, hàm tạo 1 mảng v6 32 kí tự, ```v3``` sẽ được gán bằng tham số truyền vào ```a3``` << 8. Lặp qua từng phần tử của v6 sẽ được gán
bằng giá trị của mảng ```byte_563F0BE39560``` tại chỉ số ```v3 + a2[i]```, i chạy từ 0-0x1f, với tham số truyền vào ```a2``` là 1 con trỏ trỏ đến 1 mảng.

![image](https://github.com/m01000xd/picoCTF/assets/122852491/86176ed4-8be8-47b2-aff6-188f238f635b)

Mảng ```byte_563F0BE39560``` là 1 mảng cho trước

Sau đó tạo biến ```v4```  sẽ bằng giá trị của mảng ```asc_563F0BE39970``` gồm 1024 kí tự, với ```v4``` sẽ lần lượt được gán bằng ```asc_563F0BE39970[v3+k]```,
k được nhập lần lượt trong hàm. Chương trình sẽ kiểm tra xem ```v4``` có > 0x1f không, nếu có thì trả về ```Index out of bound```

![image](https://github.com/m01000xd/picoCTF/assets/122852491/76f36eaa-647f-43df-87c2-aada06e991ff)

Rồi chương trình sẽ gán giá trị cho từng phần tử của tham số ```a1[j]```, với j được nhập lần lượt trong hàm, = với giá trị của ```v6[v4]``` vừa được gán 
lần lượt ở trên.

![image](https://github.com/m01000xd/picoCTF/assets/122852491/dbe92919-a4a4-4ed8-b1c0-2b57fdb57485)

Ta thấy mỗi lần gọi hàm, ```v8``` sẽ lấy giá trị mà hàm trả về, là 1 mảng bị mã hóa, sau đó lại truyền ```v8``` làm tham số ```a2``` để gọi lại hàm
Cứ như vậy, qua 4 lần thì password của chúng ta được mã hóa và lưu cuối cùng ở mảng ```v33```.

![image](https://github.com/m01000xd/picoCTF/assets/122852491/5f9fb657-fce9-4e3d-9f5c-8a33d82345e5)
![image](https://github.com/m01000xd/picoCTF/assets/122852491/7d17d91b-1489-41c9-bb06-e4b057d8b9d7)
![image](https://github.com/m01000xd/picoCTF/assets/122852491/f237f535-42bb-4772-8e92-8f7a65ce0208)

Xuống dưới đây, thực chất đoạn này là để check xem mảng ```v33``` có phải là mảng ```byte_563F0BE39D95``` cho sẵn không.

![image](https://github.com/m01000xd/picoCTF/assets/122852491/b8af392b-e098-4897-8036-63f63f7068d6)

![image](https://github.com/m01000xd/picoCTF/assets/122852491/1699a622-ecf8-4fae-8d9f-059f08e0a32e)

Nếu password nhập vào sai hoặc độ dài != 41, chương trình sẽ trả về ```Invalid password``` hoặc ```Invalid length```.

Tóm lại, ta đã hiểu sơ qua chương trình. Giờ ta sẽ viết script để lấy flag.

### Script

```python3
asc = [11, 0, 0, 0, 0, 0, 0, 0, 4, 0, 0, 0, 0, 0, 0, 0, 19, 0, 0, 0, 0, 0, 0, 0, 13, 0, 0, 0, 0, 0, 0, 0, 9, 0, 0, 0, 0, 0, 0, 0, 29, 0, 0, 0, 0, 0, 0, 0, 24, 0, 0, 0, 0, 0, 0, 0, 28, 0, 0, 0, 0, 0, 0, 0, 12, 0, 0, 0, 0, 0, 0, 0, 20, 0, 0, 0, 0, 0, 0, 0, 16, 0, 0, 0, 0, 0, 0, 0, 25, 0, 0, 0, 0, 0, 0, 0, 15, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 10, 0, 0, 0, 0, 0, 0, 0, 5, 0, 0, 0, 0, 0, 0, 0, 26, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 14, 0, 0, 0, 0, 0, 0, 0, 6, 0, 0, 0, 0, 0, 0, 0, 30, 0, 0, 0, 0, 0, 0, 0, 3, 0, 0, 0, 0, 0, 0, 0, 8, 0, 0, 0, 0, 0, 0, 0, 27, 0, 0, 0, 0, 0, 0, 0, 2, 0, 0, 0, 0, 0, 0, 0, 31, 0, 0, 0, 0, 0, 0, 0, 21, 0, 0, 0, 0, 0, 0, 0, 17, 0, 0, 0, 0, 0, 0, 0, 22, 0, 0, 0, 0, 0, 0, 0, 18, 0, 0, 0, 0, 0, 0, 0, 23, 0, 0, 0, 0, 0, 0, 0, 7, 0, 0, 0, 0, 0, 0, 0, 28, 0, 0, 0, 0, 0, 0, 0, 16, 0, 0, 0, 0, 0, 0, 0, 31, 0, 0, 0, 0, 0, 0, 0, 8, 0, 0, 0, 0, 0, 0, 0, 27, 0, 0, 0, 0, 0, 0, 0, 26, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 17, 0, 0, 0, 0, 0, 0, 0, 25, 0, 0, 0, 0, 0, 0, 0, 21, 0, 0, 0, 0, 0, 0, 0, 9, 0, 0, 0, 0, 0, 0, 0, 2, 0, 0, 0, 0, 0, 0, 0, 18, 0, 0, 0, 0, 0, 0, 0, 24, 0, 0, 0, 0, 0, 0, 0, 7, 0, 0, 0, 0, 0, 0, 0, 22, 0, 0, 0, 0, 0, 0, 0, 30, 0, 0, 0, 0, 0, 0, 0, 11, 0, 0, 0, 0, 0, 0, 0, 10, 0, 0, 0, 0, 0, 0, 0, 23, 0, 0, 0, 0, 0, 0, 0, 20, 0, 0, 0, 0, 0, 0, 0, 19, 0, 0, 0, 0, 0, 0, 0, 5, 0, 0, 0, 0, 0, 0, 0, 4, 0, 0, 0, 0, 0, 0, 0, 13, 0, 0, 0, 0, 0, 0, 0, 12, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 3, 0, 0, 0, 0, 0, 0, 0, 14, 0, 0, 0, 0, 0, 0, 0, 15, 0, 0, 0, 0, 0, 0, 0, 29, 0, 0, 0, 0, 0, 0, 0, 6, 0, 0, 0, 0, 0, 0, 0, 7, 0, 0, 0, 0, 0, 0, 0, 2, 0, 0, 0, 0, 0, 0, 0, 18, 0, 0, 0, 0, 0, 0, 0, 11, 0, 0, 0, 0, 0, 0, 0, 17, 0, 0, 0, 0, 0, 0, 0, 5, 0, 0, 0, 0, 0, 0, 0, 24, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 31, 0, 0, 0, 0, 0, 0, 0, 19, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 3, 0, 0, 0, 0, 0, 0, 0, 29, 0, 0, 0, 0, 0, 0, 0, 14, 0, 0, 0, 0, 0, 0, 0, 30, 0, 0, 0, 0, 0, 0, 0, 22, 0, 0, 0, 0, 0, 0, 0, 27, 0, 0, 0, 0, 0, 0, 0, 21, 0, 0, 0, 0, 0, 0, 0, 4, 0, 0, 0, 0, 0, 0, 0, 16, 0, 0, 0, 0, 0, 0, 0, 28, 0, 0, 0, 0, 0, 0, 0, 10, 0, 0, 0, 0, 0, 0, 0, 12, 0, 0, 0, 0, 0, 0, 0, 25, 0, 0, 0, 0, 0, 0, 0, 13, 0, 0, 0, 0, 0, 0, 0, 8, 0, 0, 0, 0, 0, 0, 0, 20, 0, 0, 0, 0, 0, 0, 0, 6, 0, 0, 0, 0, 0, 0, 0, 9, 0, 0, 0, 0, 0, 0, 0, 23, 0, 0, 0, 0, 0, 0, 0, 15, 0, 0, 0, 0, 0, 0, 0, 26, 0, 0, 0, 0, 0, 0, 0, 18, 0, 0, 0, 0, 0, 0, 0, 13, 0, 0, 0, 0, 0, 0, 0, 20, 0, 0, 0, 0, 0, 0, 0, 5, 0, 0, 0, 0, 0, 0, 0, 12, 0, 0, 0, 0, 0, 0, 0, 29, 0, 0, 0, 0, 0, 0, 0, 23, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 15, 0, 0, 0, 0, 0, 0, 0, 9, 0, 0, 0, 0, 0, 0, 0, 2, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 4, 0, 0, 0, 0, 0, 0, 0, 6, 0, 0, 0, 0, 0, 0, 0, 8, 0, 0, 0, 0, 0, 0, 0, 24, 0, 0, 0, 0, 0, 0, 0, 11, 0, 0, 0, 0, 0, 0, 0, 22, 0, 0, 0, 0, 0, 0, 0, 16, 0, 0, 0, 0, 0, 0, 0, 10, 0, 0, 0, 0, 0, 0, 0, 28, 0, 0, 0, 0, 0, 0, 0, 14, 0, 0, 0, 0, 0, 0, 0, 17, 0, 0, 0, 0, 0, 0, 0, 21, 0, 0, 0, 0, 0, 0, 0, 30, 0, 0, 0, 0, 0, 0, 0, 27, 0, 0, 0, 0, 0, 0, 0, 26, 0, 0, 0, 0, 0, 0, 0, 25, 0, 0, 0, 0, 0, 0, 0, 19, 0, 0, 0, 0, 0, 0, 0, 7, 0, 0, 0, 0, 0, 0, 0, 3, 0, 0, 0, 0, 0, 0, 0, 31, 0, 0, 0, 0, 0, 0, 0]

ascii_table = [165, 224, 130, 8, 104, 56, 22, 253, 189, 173, 20, 126, 171, 30, 235, 166, 207, 54, 55, 204, 233, 136, 79, 58, 195, 6, 93, 175, 149, 15, 179, 88, 146, 252, 140, 229, 96, 43, 194, 105, 102, 34, 184, 13, 239, 132, 95, 160, 215, 110, 42, 203, 70, 44, 241, 177, 169, 222, 213, 183, 206, 57, 98, 232, 112, 12, 33, 198, 100, 125, 187, 193, 152, 32, 2, 255, 127, 85, 107, 108, 244, 84, 240, 86, 201, 87, 157, 208, 197, 129, 67, 103, 223, 248, 71, 181, 121, 159, 60, 31, 156, 24, 128, 154, 141, 48, 217, 148, 47, 66, 80, 53, 116, 17, 142, 78, 196, 4, 176, 225, 92, 61, 114, 199, 25, 106, 77, 73, 3, 21, 145, 153, 26, 5, 192, 231, 82, 139, 111, 89, 249, 133, 211, 188, 37, 205, 182, 219, 236, 91, 123, 246, 170, 115, 29, 254, 38, 65, 62, 163, 83, 237, 90, 52, 234, 172, 23, 144, 16, 51, 99, 167, 210, 118, 247, 190, 131, 74, 122, 10, 220, 69, 214, 72, 238, 36, 242, 68, 18, 49, 28, 50, 218, 94, 35, 45, 168, 164, 0, 27, 64, 120, 101, 124, 113, 216, 135, 221, 1, 59, 75, 191, 39, 97, 109, 11, 161, 227, 209, 81, 158, 212, 251, 174, 250, 243, 180, 14, 202, 147, 9, 200, 185, 151, 117, 76, 228, 150, 63, 155, 119, 230, 41, 19, 7, 178, 46, 137, 40, 226, 162, 143, 138, 134, 245, 186, 105, 2, 100, 19, 75, 210, 228, 245, 132, 236, 192, 225, 72, 18, 91, 148, 181, 139, 237, 101, 87, 208, 15, 62, 55, 136, 211, 224, 52, 232, 45, 155, 173, 70, 42, 31, 89, 46, 108, 200, 14, 222, 106, 182, 121, 135, 34, 151, 197, 20, 25, 221, 193, 183, 144, 66, 179, 235, 231, 23, 77, 85, 254, 13, 246, 51, 198, 230, 109, 226, 177, 3, 71, 243, 38, 252, 22, 27, 194, 40, 7, 96, 172, 118, 141, 111, 97, 203, 107, 128, 157, 21, 175, 56, 176, 209, 212, 88, 61, 131, 251, 166, 26, 163, 115, 120, 36, 229, 65, 234, 204, 63, 249, 143, 190, 159, 110, 68, 73, 187, 167, 76, 64, 178, 242, 49, 202, 215, 233, 184, 114, 185, 84, 50, 92, 213, 199, 74, 17, 8, 186, 117, 220, 189, 125, 24, 98, 39, 145, 138, 116, 205, 53, 152, 123, 5, 195, 67, 165, 241, 41, 255, 113, 227, 78, 82, 37, 81, 196, 47, 30, 149, 171, 102, 86, 146, 127, 10, 32, 218, 147, 214, 180, 57, 16, 158, 216, 188, 4, 206, 93, 142, 140, 58, 169, 0, 223, 250, 59, 103, 104, 83, 122, 162, 69, 79, 124, 6, 164, 129, 28, 137, 217, 160, 44, 33, 150, 161, 95, 119, 174, 134, 130, 156, 170, 244, 219, 207, 191, 168, 99, 248, 11, 9, 60, 201, 239, 240, 43, 90, 238, 153, 1, 48, 133, 94, 126, 54, 29, 253, 80, 112, 12, 154, 35, 247, 206, 106, 235, 197, 71, 22, 232, 220, 140, 57, 175, 179, 31, 195, 104, 126, 253, 16, 218, 60, 30, 21, 87, 163, 227, 168, 78, 5, 10, 118, 116, 224, 151, 119, 147, 159, 123, 113, 49, 245, 59, 172, 180, 155, 198, 94, 154, 55, 34, 1, 212, 153, 135, 228, 173, 167, 107, 36, 20, 100, 98, 234, 82, 124, 56, 92, 204, 252, 35, 84, 72, 37, 9, 149, 46, 177, 52, 225, 255, 23, 58, 239, 201, 80, 62, 251, 114, 208, 77, 42, 75, 166, 244, 133, 202, 0, 48, 193, 108, 70, 53, 221, 132, 148, 47, 86, 233, 109, 85, 6, 139, 54, 158, 93, 213, 63, 144, 96, 103, 246, 136, 176, 121, 216, 161, 250, 2, 141, 73, 241, 129, 130, 185, 67, 105, 238, 91, 4, 226, 97, 14, 183, 192, 240, 40, 169, 115, 131, 28, 190, 76, 19, 117, 145, 27, 205, 189, 127, 12, 134, 26, 164, 210, 138, 247, 68, 69, 171, 50, 66, 207, 222, 25, 142, 79, 111, 110, 199, 184, 237, 165, 65, 200, 41, 13, 150, 89, 99, 214, 186, 248, 61, 219, 157, 120, 152, 38, 162, 254, 44, 188, 39, 137, 3, 81, 211, 17, 217, 101, 231, 230, 51, 15, 146, 181, 156, 191, 203, 24, 112, 196, 7, 174, 125, 178, 45, 143, 194, 32, 242, 170, 64, 215, 18, 29, 182, 88, 90, 160, 43, 74, 243, 11, 249, 95, 8, 223, 122, 236, 102, 187, 229, 83, 209, 33, 128, 17, 131, 77, 111, 26, 10, 145, 53, 95, 62, 128, 20, 169, 218, 246, 85, 212, 224, 1, 174, 119, 9, 33, 101, 155, 170, 86, 162, 112, 16, 190, 134, 241, 19, 117, 25, 30, 103, 7, 242, 149, 37, 124, 105, 239, 254, 68, 15, 113, 195, 237, 238, 106, 167, 208, 178, 76, 89, 44, 227, 47, 150, 127, 226, 165, 233, 204, 43, 12, 118, 200, 148, 73, 187, 23, 2, 236, 140, 100, 11, 4, 203, 186, 166, 27, 79, 21, 121, 151, 130, 65, 189, 116, 75, 185, 98, 230, 199, 192, 84, 80, 147, 247, 160, 0, 231, 172, 3, 220, 90, 229, 193, 29, 126, 60, 42, 74, 214, 108, 217, 219, 179, 163, 71, 81, 32, 6, 91, 255, 153, 41, 253, 196, 161, 251, 133, 177, 222, 40, 221, 102, 52, 88, 36, 197, 141, 234, 198, 96, 243, 225, 159, 207, 35, 175, 46, 64, 92, 125, 24, 194, 115, 205, 173, 67, 129, 144, 34, 94, 45, 181, 245, 240, 152, 38, 211, 249, 107, 180, 213, 28, 31, 57, 158, 182, 156, 136, 69, 210, 61, 168, 82, 209, 70, 22, 202, 244, 110, 120, 104, 8, 56, 137, 201, 146, 13, 171, 176, 54, 223, 58, 99, 250, 39, 188, 164, 184, 50, 78, 14, 123, 114, 109, 83, 93, 215, 142, 55, 87, 48, 135, 235, 66, 18, 154, 191, 59, 232, 228, 183, 63, 97, 206, 5, 216, 252, 248, 49, 132, 157, 51, 139, 122, 143, 72, 138]

enc = [31, 167, 80, 205, 184, 34, 58, 203, 167, 215, 174, 203, 167, 32, 193, 72, 5, 123, 123, 32, 205, 131, 70, 18, 207, 230, 153, 174, 116, 153, 1, 123]

order = [8, 0x19, 0x1b, 0x1c, 0x11, 0xe, 0xc, 0xf, 2, 0x15, 0x10, 9, 0x13, 0xa, 0xd, 6, 0x16, 0, 0x1e, 1, 4, 0x1a, 0x1d, 3, 0x1f, 0x14, 0x18, 7, 0xb, 0x17, 5, 0x12]

plus = [0x40, 0xc8, 0xd8, 0xe0, 0x88, 0x70, 0x60, 0x78, 0x10, 0xa8, 0x80, 0x48, 0x98, 0x50, 0x68, 0x30, 0xb0, 0, 0xf0, 8, 0x20, 0xd0, 0xe8, 0x18, 0xf8, 0xa0, 0xc0, 0x38, 0x58, 0xb8, 0x28, 0x90]


def decrypt(enc,n):
    v = n << 8
    v4 = [asc[v + plus[i]] for i in range(0x20)]
    v6 = [0]*0x20
    for i in range(0x20):
        v6[v4[i]] = enc[order[i]]
    lst = []
    for i in range(0x20):
        for j in range(256):
            if ascii_table[v+j] == v6[i]:
                lst.append(j)
    return lst
                

a = decrypt(enc,3)
b = decrypt(a,2)
c = decrypt(b,1)
d = decrypt(c,0)
flag = 'picoCTF{' + ''.join([chr(i) for i in d]) + '}'
print(flag)
```

### Flag

    picoCTF{t1mingS1deChann3l_Ef2i9OxJtbJJ9l}
